---
import BaseLayout from "../layouts/BaseLayout.astro";
import { format } from "date-fns";
import { fr } from "date-fns/locale";

// --- CONFIGURATION AIRTABLE ---
const AIRTABLE_TOKEN = import.meta.env.AIRTABLE_TOKEN;
const BASE_ID = import.meta.env.AIRTABLE_BASE_ID;
const TABLE_NAME = import.meta.env.AIRTABLE_TABLE_NAME;

let annoncesAirtable = [];

try {
  const response = await fetch(
    `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}?sort%5B0%5D%5Bfield%5D=Ordre&sort%5B0%5D%5Bdirection%5D=asc`,
    {
      headers: { Authorization: `Bearer ${AIRTABLE_TOKEN}` },
    }
  );
  const data = await response.json();
  annoncesAirtable =
    data.records?.filter((r) => r.fields.Titre && r.fields.Publié === true) || [];
} catch (e) {
  console.error("Erreur Airtable:", e);
}

const clubName = "BOXING CLUB COLAK";
const city = "La Louvière";
const adresseClub = "Rue de l'Olive 13A, 7100 La Louvière";
const clubEmail = "mirac.colak@outlook.com";
const clubPhone = "0487 11 88 77";

const horaires = [
  { jour: "Lundi", type: "Compétiteurs / Débutant / Récréant", heure: "18h00 – 20h00" },
  { jour: "Mardi", type: "Débutant / Récréant", heure: "18h00 – 20h00" },
  { jour: "Mercredi", type: "Compétiteurs", heure: "18h00 – 20h00" },
  { jour: "Jeudi", type: "Débutant / Récréant", heure: "18h00 – 20h00" },
  { jour: "Vendredi", type: "Compétiteurs", heure: "18h00 – 20h00" },
];

const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": "SportsClub",
  name: clubName,
  address: {
    "@type": "PostalAddress",
    streetAddress: "Rue de l'Olive 13A",
    addressLocality: "La Louvière",
    addressRegion: "Wallonie",
    postalCode: "7100",
    addressCountry: "BE",
  },
  email: clubEmail,
  telephone: clubPhone,
  url: Astro.site?.href || "https://clubcolak.be",
};

const schema = JSON.stringify(localBusinessSchema);
---

<BaseLayout
  title={`${clubName} — Boxe anglaise à ${city}`}
  description={`Club de boxe anglaise à ${city}. Discipline, encadrement et progression dans un cadre sérieux.`}
  schema={schema}
>
  <section class="hero">
    <div class="hero-decor-line"></div>
    <div class="hero-bg-name">COLAK</div>
    
    <div class="container hero-grid">
      <div class="hero-main">
        <div class="hero-badge reveal">
          <span class="line"></span>
          <span>BOXE ANGLAISE / {city}</span>
        </div>

        <h1 class="hero-title reveal">
          <span>BOXING CLUB</span><br/>
          <span class="text-stroke">COLAK</span>
        </h1>

        <div class="hero-actions reveal">
          <a href="/contact?sujet=essai" class="btn-main">
            SÉANCE D’ESSAI
          </a>
          <a href="#horaires" class="btn-secondary">VOIR LE PLANNING</a>
        </div>
      </div>

      <div class="hero-details reveal">
        <div class="manifesto">
          <p>Discipline. Cadre. Exigence.</p>
          <p class="punchline">PAS UN LOISIR. UNE PRATIQUE.</p>
        </div>

        <div class="proof-points">
          <div class="proof">
            <span class="num">01</span>
            <div class="txt"><strong>CADRE</strong><span>Strict & respecté</span></div>
          </div>
          <div class="proof">
            <span class="num">02</span>
            <div class="txt"><strong>COACH</strong><span>Présent & exigeant</span></div>
          </div>
          <div class="proof">
            <span class="num">03</span>
            <div class="txt"><strong>PROGRESSION</strong><span>Suivie & réelle</span></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="grid-split">
        <h2 class="section-title">Un cadre clair,<br/>des profils motivés</h2>
        <div class="section-content">
          <p>Débutant complet, pratiquant loisir ou compétiteur : chacun a sa place, à condition de respecter le cadre.</p>
          <p style="margin-top:20px;"><strong>Ponctualité, discipline et engagement ne sont pas négociables.</strong></p>
        </div>
      </div>
    </div>
  </section>

  <section class="section alt" id="news">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title small">Actualités & Annonces</h2>
      </div>
      
      <div class="annonces-list">
        {
          annoncesAirtable.length > 0 ? (
            annoncesAirtable.map((a) => (
              <article class={`annonce-row ${a.fields.Urgent ? "urgent" : ""}`}>
                {a.fields.Image && a.fields.Image[0] && (
                  <div class="annonce-img-container">
                    <img
                      src={a.fields.Image[0].url}
                      alt={a.fields.Titre}
                      loading="lazy"
                      class="clickable-img"
                    />
                    <div class="zoom-overlay" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        <line x1="11" y1="8" x2="11" y2="14"></line>
                        <line x1="8" y1="11" x2="14" y2="11"></line>
                      </svg>
                    </div>
                  </div>
                )}

                <div class="annonce-body">
                  <div class="annonce-header">
                    <span class="date">{format(new Date(a.createdTime), "dd MMMM", { locale: fr })}</span>
                    {a.fields.Urgent && <span class="tag-urgent">URGENT</span>}
                  </div>
                  <h3>{a.fields.Titre}</h3>
                  <p class="message">{a.fields.Message}</p>
                </div>
              </article>
            ))
          ) : (
            <p style="color: #666;">Aucune annonce pour le moment.</p>
          )
        }
      </div>
    </div>
  </section>

  <div id="custom-lightbox" class="custom-lightbox" style="display: none;">
    <span class="close-lightbox" aria-label="Fermer">×</span>
    <img id="lightbox-img" src="" alt="" />
  </div>

  <section class="section" id="horaires">
    <div class="container">
      <h2 class="section-title">Planning d'entraînement</h2>
      <div class="schedule">
        <table class="schedule-table">
          <thead>
            <tr>
              <th>Jour</th>
              <th>Type de séance</th>
              <th>Heure</th>
            </tr>
          </thead>
          <tbody>
            {horaires.map((h) => (
              <tr>
                <td class="td-day">{h.jour}</td>
                <td class="td-type">{h.type}</td>
                <td class="td-time">{h.heure}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="section alt">
    <div class="container">
      <div class="grid-split">
        <div>
          <h2 class="section-title">Nous trouver</h2>
          <address class="address">
            {adresseClub}<br />
            <a href={`tel:${clubPhone.replace(/\s/g, "")}`} class="contact-link">{clubPhone}</a><br />
            <a href={`mailto:${clubEmail}`} class="contact-link">{clubEmail}</a>
          </address>
        </div>
        <div class="map">
          <iframe
            width="100%"
            height="350"
            style="border:0; filter: grayscale(1) invert(0.9) contrast(1.2);"
            src="https://maps.google.com/maps?q=Rue%20de%20l'Olive%2013A,%207100%20La%20Louvi%C3%A8re&t=&z=15&ie=UTF8&iwloc=&output=embed"
            allowfullscreen=""
            loading="lazy"
          />
        </div>
      </div>
    </div>
  </section>

  <style>
    /* --- HERO --- */
    .hero {
      min-height: 100vh;
      display: flex;
      align-items: center;
      position: relative;
      background: #000;
      overflow: hidden;
      padding: 120px 0 80px;
    }
    .hero-decor-line {
      position: absolute; left: 5%; top: 0; bottom: 0;
      width: 1px; background: rgba(199, 157, 49, 0.15);
      z-index: 1;
    }
    .hero-bg-name {
      position: absolute; right: -5vw; bottom: 0;
      font-family: var(--font-accent); font-size: 24vw;
      color: rgba(255,255,255,0.02); line-height: 0.8;
      pointer-events: none; z-index: 0;
    }
    .hero-grid {
      display: grid;
      grid-template-columns: 1.3fr 0.7fr;
      gap: 100px;
      position: relative; z-index: 10;
    }
    .hero-main { padding-left: 40px; }
    .hero-badge {
      display: flex; align-items: center; gap: 15px;
      font-family: var(--font-accent); color: var(--color-accent);
      letter-spacing: 4px; font-size: 0.9rem; margin-bottom: 30px;
    }
    .hero-badge .line { width: 50px; height: 1px; background: var(--color-accent); }
    .hero-title {
      font-size: clamp(4rem, 14vw, 11rem);
      margin-bottom: 50px;
      line-height: 0.85;
      color: #fff;
    }
    .hero-actions { display: flex; align-items: center; gap: 40px; }
    .btn-main {
      background: var(--color-accent); color: #000;
      padding: 25px 45px; font-family: var(--font-accent);
      font-size: 1.5rem; letter-spacing: 1px;
      box-shadow: 0 10px 30px rgba(199, 157, 49, 0.2);
    }
    .btn-main:hover { background: #fff; transform: translateY(-5px); }
    .btn-secondary {
      font-family: var(--font-accent); font-size: 1.1rem;
      color: #fff; border-bottom: 2px solid var(--color-accent);
      padding-bottom: 5px; opacity: 0.7; letter-spacing: 1px;
    }
    .hero-details {
      display: flex; flex-direction: column; justify-content: center;
      border-left: 1px solid rgba(255,255,255,0.1); padding-left: 60px;
    }
    .manifesto { font-size: 1.2rem; color: #888; margin-bottom: 60px; line-height: 1.4; }
    .manifesto .punchline { color: #fff; font-weight: 900; font-family: var(--font-accent); letter-spacing: 1px; font-size: 1.4rem; margin-top: 15px; }
    .proof-points { display: flex; flex-direction: column; gap: 40px; }
    .proof { display: flex; align-items: center; gap: 25px; }
    .num { 
      font-family: var(--font-accent); font-size: 1.5rem; color: var(--color-accent);
      width: 60px; height: 60px; border: 1px solid rgba(199,157,49,0.4);
      display: flex; align-items: center; justify-content: center;
    }
    .txt { display: flex; flex-direction: column; }
    .txt strong { font-family: var(--font-accent); font-size: 1.4rem; letter-spacing: 2px; color: #fff; }
    .txt span { font-size: 0.85rem; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }

    /* --- SECTIONS GÉNÉRALES --- */
    .section { padding: 100px 0; }
    .section.alt { background: #080808; }
    .grid-split { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: start; }
    .section-title { font-size: clamp(2.5rem, 6vw, 4rem); color: #fff; margin-bottom: 30px; }
    .section-title.small { font-size: 1.5rem; letter-spacing: 3px; color: var(--color-accent); text-transform: uppercase; }

    /* --- ANNONCES --- */
    .annonce-row {
      background: #111; border: 1px solid #222; margin-bottom: 30px;
      display: flex; flex-direction: column; overflow: hidden;
    }
    .annonce-img-container { height: 250px; position: relative; cursor: pointer; }
    .annonce-img-container img { width: 100%; height: 100%; object-fit: cover; }
    .zoom-overlay {
      position: absolute; inset: 0; background: rgba(0,0,0,0.4);
      display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.3s;
    }
    .annonce-img-container:hover .zoom-overlay { opacity: 1; }
    .annonce-body { padding: 30px; }
    .annonce-header { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; }
    .tag-urgent { background: var(--color-accent); color: #000; font-weight: 900; font-size: 0.75rem; padding: 4px 10px; }
    .message { color: rgba(255,255,255,0.8); line-height: 1.7; }

    /* --- PLANNING --- */
    .schedule-table { width: 100%; border-collapse: collapse; margin-top: 30px; }
    .schedule-table thead { display: none; }
    .schedule-table tr { border-bottom: 1px solid #1a1a1a; }
    .schedule-table td { padding: 25px 0; color: #fff; }
    .td-day { font-family: var(--font-accent); font-size: 1.8rem; color: var(--color-accent); width: 25%; }
    .td-time { font-weight: 700; text-align: right; }

    /* --- MAP & CONTACT --- */
    .map { margin-top: 10px; border: 1px solid #222; border-radius: 4px; overflow: hidden; line-height: 0; }
    .address { font-style: normal; color: #fff; line-height: 2; font-size: 1.1rem; }
    .contact-link { color: var(--color-accent); font-weight: 700; text-decoration: none; }

    /* --- LIGHTBOX --- */
    .custom-lightbox {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95);
      z-index: 3000; display: flex; align-items: center; justify-content: center; padding: 20px;
    }
    .custom-lightbox img { max-width: 95%; max-height: 85vh; border: 1px solid var(--color-accent); }
    .close-lightbox { position: absolute; top: 20px; right: 25px; color: #fff; font-size: 40px; cursor: pointer; }

    /* --- RESPONSIVE --- */
    @media (min-width: 768px) {
      .schedule-table thead { display: table-header-group; }
      .schedule-table thead th { text-align: left; color: var(--color-accent); padding-bottom: 20px; border-bottom: 2px solid var(--color-accent); }
      .schedule-table tr { display: table-row; }
      .schedule-table td { display: table-cell; padding: 30px 15px; }
      .td-time { text-align: left; }
      .annonce-row { flex-direction: row; }
      .annonce-img-container { width: 350px; height: auto; }
    }

    @media (max-width: 1024px) {
      .hero-grid { grid-template-columns: 1fr; gap: 70px; }
      .hero-main { padding-left: 0; }
      .hero-details { padding-left: 0; border-left: none; }
      .hero-decor-line, .hero-bg-name { display: none; }
      .grid-split { grid-template-columns: 1fr; gap: 40px; }
    }

    @media (max-width: 768px) {
      .hero-title { font-size: 4.5rem; }
      .hero-actions { flex-direction: column; align-items: stretch; gap: 25px; }
      .btn-main { text-align: center; }
      .td-day { font-size: 1.4rem; }
    }

    .reveal { opacity: 0; transform: translateY(40px); transition: 1.2s cubic-bezier(0.16, 1, 0.3, 1); }
    .reveal.is-visible { opacity: 1; transform: translateY(0); }
  </style>

  <script is:inline>
    // Reveal animation
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if(entry.isIntersecting) entry.target.classList.add('is-visible');
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    // Lightbox
    const lightbox = document.getElementById("custom-lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    const clickableImgs = document.querySelectorAll(".clickable-img");
    const closeBtn = document.querySelector(".close-lightbox");

    clickableImgs.forEach((img) => {
      img.addEventListener("click", () => {
        if (lightbox && lightboxImg) {
          lightboxImg.src = img.src;
          lightbox.style.display = "flex";
          document.body.style.overflow = "hidden";
        }
      });
    });

    const closeLightbox = () => {
      if (!lightbox) return;
      lightbox.style.display = "none";
      document.body.style.overflow = "auto";
    };

    lightbox?.addEventListener("click", (e) => { if(e.target === lightbox) closeLightbox(); });
    closeBtn?.addEventListener("click", closeLightbox);
  </script>
</BaseLayout>