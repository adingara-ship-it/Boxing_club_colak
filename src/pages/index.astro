---
import BaseLayout from "../layouts/BaseLayout.astro";
import { format } from "date-fns";
import { fr } from "date-fns/locale";

// --- CONFIGURATION AIRTABLE ---
const AIRTABLE_TOKEN = import.meta.env.AIRTABLE_TOKEN;
const BASE_ID = import.meta.env.AIRTABLE_BASE_ID;
const TABLE_NAME = import.meta.env.AIRTABLE_TABLE_NAME;

let annoncesAirtable = [];

try {
  const response = await fetch(
    `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}?sort%5B0%5D%5Bfield%5D=Ordre&sort%5B0%5D%5Bdirection%5D=asc`,
    {
      headers: { Authorization: `Bearer ${AIRTABLE_TOKEN}` }
    }
  );
  const data = await response.json();
  annoncesAirtable = data.records?.filter(r => r.fields.Titre && r.fields.Publié === true) || [];
} catch (e) {
  console.error("Erreur Airtable:", e);
}

const clubName = "BOXING CLUB COLAK";
const city = "La Louvière";
const adresseClub = "Rue de l'Olive 13A, 7100 La Louvière";
const clubEmail = "mirac.colak@outlook.com";
const clubPhone = "0487 11 88 77";

const horaires = [
  { jour: "Lundi", type: "Compétiteurs / Débutant / Récréant", heure: "18h00 – 20h00" },
  { jour: "Mardi", type: "Débutant / Récréant", heure: "18h00 – 20h00" },
  { jour: "Mercredi", type: "Compétiteurs", heure: "18h00 – 20h00" },
  { jour: "Jeudi", type: "Débutant / Récréant", heure: "18h00 – 20h00" },
  { jour: "Vendredi", type: "Compétiteurs", heure: "18h00 – 20h00" },
];

const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": "SportsClub",
  name: clubName,
  address: {
    "@type": "PostalAddress",
    streetAddress: "Rue de l'Olive 13A",
    addressLocality: "La Louvière",
    addressRegion: "Wallonie",
    postalCode: "7100",
    addressCountry: "BE",
  },
  email: clubEmail,
  telephone: clubPhone,
  url: Astro.site?.href || "https://clubcolak.be",
};

const schema = JSON.stringify(localBusinessSchema);
---

<BaseLayout
  title={`${clubName} — Boxe anglaise à ${city}`}
  description={`Club de boxe anglaise à ${city}. Discipline, encadrement et progression dans un cadre sérieux.`}
  schema={schema}
>

<!-- HERO (MODIFIÉ UNIQUEMENT ICI) -->
<section class="hero" aria-labelledby="hero-title">
  <div class="hero-overlay"></div>
  <div class="hero-grain"></div>

  <div class="container">
    <div class="hero-wrapper">
      <p class="hero-location reveal">Boxe anglaise · {city}</p>

      <h1 id="hero-title" class="hero-title reveal">
        {clubName}
      </h1>

      <p class="hero-subtitle reveal">
        Discipline. Cadre. Exigence.
        <br />
        <strong>Pas un loisir. Une pratique.</strong>
      </p>

      <div class="hero-actions reveal">
        <a href="/contact?sujet=essai" class="cta-button">Séance d’essai</a>
        <a href="#horaires" class="hero-link-secondary">Horaires</a>
      </div>

      <div class="hero-divider reveal"></div>

      <ul class="hero-proof reveal" role="list">
        <li class="proof-card">
          <span class="proof-title">CADRE</span>
          <span class="proof-text">structuré & respecté</span>
        </li>
        <li class="proof-card">
          <span class="proof-title">COACH</span>
          <span class="proof-text">présent et exigeant</span>
        </li>
        <li class="proof-card">
          <span class="proof-title">PROGRESSION</span>
          <span class="proof-text">suivie dans le temps</span>
        </li>
      </ul>
    </div>
  </div>
</section>

<section class="section">
  <div class="container narrow">
    <h2 class="section-title">Un cadre clair, pour des profils motivés</h2>
    <p class="section-text">
      Débutant complet, pratiquant loisir ou compétiteur : chacun a sa place, à condition de respecter le cadre.
      <br />
      Ponctualité, discipline et engagement ne sont pas négociables.
    </p>
  </div>
</section>

<section class="section alt">
  <div class="container">
    <h2 class="section-title">Annonces & actualités</h2>
    <div class="annonces-list">
      {annoncesAirtable.length > 0 ? annoncesAirtable.map((a) => (
        <article class={`annonce-row ${a.fields.Urgent ? "urgent" : ""}`}>
          {a.fields.Image && a.fields.Image[0] && (
            <div class="annonce-img-container">
              <img src={a.fields.Image[0].url} alt={a.fields.Titre} loading="lazy" class="clickable-img" />
              <div class="zoom-overlay">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
              </div>
            </div>
          )}
          <div class="annonce-body">
            <div class="annonce-header">
              <span class="date">{format(new Date(a.createdTime), 'dd MMMM', { locale: fr })}</span>
              {a.fields.Urgent && <span class="tag-urgent">URGENT</span>}
            </div>
            <h3>{a.fields.Titre}</h3>
            <p class="message">{a.fields.Message}</p>
          </div>
        </article>
      )) : (
        <p>Aucune annonce pour le moment.</p>
      )}
    </div>
  </div>
</section>

<div id="custom-lightbox" class="custom-lightbox" style="display: none;">
  <span class="close-lightbox">×</span>
  <img id="lightbox-img" src="" alt="" />
</div>

<section class="section" id="horaires">
  <div class="container">
    <h2 class="section-title">Horaires d'entraînement</h2>
    <div class="schedule">
      <table>
        <thead>
          <tr>
            <th>Jour</th>
            <th>Type</th>
            <th>Heure</th>
          </tr>
        </thead>
        <tbody>
          {horaires.map((h) => (
            <tr class="schedule-row">
              <td class="day">{h.jour}</td>
              <td class="type">{h.type}</td>
              <td class="time">{h.heure}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>
</section>

<section class="section alt">
  <div class="container">
    <h2 class="section-title">Nous trouver</h2>
    <address class="address">
        {adresseClub}<br />
        <a href={`tel:${clubPhone.replace(/\s/g, "")}`} class="contact-link">{clubPhone}</a><br />
        <a href={`mailto:${clubEmail}`} class="contact-link">{clubEmail}</a>
    </address>
    <div class="map">
      <iframe
        width="100%"
        height="400"
        style="border:0; filter: grayscale(1) invert(0.9) contrast(1.2);"
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2543.0416962295627!2d4.184267477161864!3d50.47102118604928!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47c2497e322ec9bb%3A0x8e64d515df3adb66!2sRue%20de%20l&#39;Olive%2013A%2C%207100%20La%20Louvi%C3%A8re!5e0!3m2!1sfr!2sbe!4v1715852000000!5m2!1sfr!2sbe"
        allowfullscreen=""
        loading="lazy">
      </iframe>
    </div>
  </div>
</section>

</BaseLayout>

<script>
  import { gsap } from "gsap";

  window.addEventListener('load', () => {
    gsap.from(".reveal", {
      y: 20,
      opacity: 0,
      duration: 0.6,
      stagger: 0.15,
      ease: "power2.out"
    });
  });

  const lightbox = document.getElementById('custom-lightbox');
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
  const clickableImgs = document.querySelectorAll('.clickable-img');

  clickableImgs.forEach(img => {
    img.addEventListener('click', () => {
      if(lightbox && lightboxImg) {
        lightboxImg.src = (img as HTMLImageElement).src;
        lightbox.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    });
  });

  lightbox?.addEventListener('click', () => {
    lightbox.style.display = 'none';
    document.body.style.overflow = 'auto';
  });
</script>

<style>
:root { --color-accent: #c79d31; }

.container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 24px; }
.container.narrow { max-width: 700px; }
.section { padding: 80px 0; }
.section.alt { background: rgba(199,157,49,0.03); }

/* HERO (MODIFIÉ UNIQUEMENT ICI) */
.hero {
  min-height: 85vh;
  display: flex;
  align-items: center;
  background: radial-gradient(circle at 20% 30%, #1a1a1a 0%, #050505 100%);
  position: relative;
  overflow: hidden;
  padding: 110px 0 70px 0;
}

.hero-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(0,0,0,0.85) 0%,
    rgba(0,0,0,0.55) 35%,
    rgba(0,0,0,0.90) 100%
  );
  pointer-events: none;
  z-index: 0;
}

.hero-grain {
  position: absolute; inset: 0;
  background-image: url("https://grainy-gradients.vercel.app/noise.svg");
  opacity: 0.08; pointer-events: none;
  z-index: 1;
}

.hero-wrapper { position: relative; z-index: 2; max-width: 760px; }

.hero-location {
  color: var(--color-accent);
  text-transform: uppercase;
  letter-spacing: 3px;
  font-size: 0.75rem;
  font-weight: 800;
  margin-bottom: 18px;
}

.hero-title {
  font-size: clamp(2.6rem, 9vw, 5.2rem);
  line-height: 1.05;
  color: #fff;
  font-weight: 900;
  text-transform: uppercase;
  margin: 0;
}

.hero-subtitle {
  color: #cfcfcf;
  max-width: 560px;
  margin: 28px 0 44px 0;
  font-size: 1.08rem;
  line-height: 1.65;
}

.hero-actions {
  display: flex;
  flex-direction: column;
  gap: 18px;
  margin-bottom: 44px;
}

.cta-button {
  background: var(--color-accent);
  color: #000;
  padding: 18px 32px;
  font-weight: 800;
  text-align: center;
  text-decoration: none;
  text-transform: uppercase;
  transition: 0.3s;
}

.hero-link-secondary {
  color: #fff;
  text-decoration: underline;
  text-underline-offset: 5px;
  font-weight: 600;
  text-align: center;
}

.hero-divider {
  width: 86px;
  height: 2px;
  background: var(--color-accent);
  margin: 0 0 26px 0;
  opacity: 0.9;
}

.hero-proof { display: grid; grid-template-columns: 1fr; gap: 15px; list-style: none; padding: 0; }
.proof-card { background: rgba(255,255,255,0.03); border-left: 3px solid var(--color-accent); padding: 20px;}
.proof-title { color: var(--color-accent); font-size: 0.75rem; font-weight: 800; letter-spacing: 1px; margin-bottom: 5px; display: block;}
.proof-text { color: #fff; font-size: 0.95rem; font-weight: 500;}

/* ANNONCES */
.annonce-row { background: #111; border: 1px solid #222; margin-bottom: 20px; display: flex; flex-direction: column; }
.annonce-img-container { height: 200px; position: relative; cursor: pointer; }
.annonce-img-container img { width: 100%; height: 100%; object-fit: cover; }
.annonce-body { padding: 20px; }

/* LIGHTBOX */
.custom-lightbox { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; display: flex; align-items: center; justify-content: center;}
.custom-lightbox img { max-width: 90%; max-height: 80vh; border: 2px solid var(--color-accent); }
.close-lightbox { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 35px; cursor: pointer; }

/* HORAIRES & MAP */
.schedule table { width: 100%; border-collapse: collapse; }
.schedule thead { display: none; }
.schedule tr { display: block; border-bottom: 1px solid #222; padding: 15px 0; }
.schedule td { display: block; padding: 5px 0; color: #fff; }
.day { color: var(--color-accent) !important; font-weight: 800; font-size: 1.1rem; }

.map { margin-top: 30px; border: 1px solid #333; line-height: 0; }

.address { color: #fff; font-style: normal; line-height: 1.8; margin-bottom: 20px; }
.contact-link { color: var(--color-accent); text-decoration: none; font-weight: 600; }

@media (min-width: 768px) {
  .hero-actions { flex-direction: row; align-items: center; }
  .hero-proof { grid-template-columns: repeat(3, 1fr); gap: 25px; }
  .schedule thead { display: table-header-group; }
  .schedule tr { display: table-row; }
  .schedule td, .schedule th { display: table-cell; padding: 20px; text-align: left; color: #fff; }
  .schedule th { color: var(--color-accent); border-bottom: 2px solid var(--color-accent); }
  .annonce-row { flex-direction: row; }
  .annonce-img-container { width: 300px; height: auto; }
}
</style>
